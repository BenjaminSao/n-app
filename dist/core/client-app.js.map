{"version":3,"file":"client-app.js","sourceRoot":"","sources":["../../src/core/client-app.ts"],"names":[],"mappings":"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","sourcesContent":["const Vue = require(\"./../../vendor/vue.v2.4.2.js\");\n\n// public\nexport { Vue }\n\nconst VueRouter = require(\"./../../vendor/vue-router.v2.7.0.js\");\nVue.use(VueRouter);\n\n\nimport { given } from \"n-defensive\";\nimport \"n-ext\";\nimport { Container, ComponentInstaller } from \"n-ject\";\nimport { ComponentManager } from \"./component-manager\";\nimport { PageManager } from \"./page-manager\";\nimport { InvalidOperationException } from \"n-exception\";\nimport { DefaultDialogService } from \"./../services/dialog-service/default-dialog-service\";\nimport { DefaultEventAggregator } from \"./../services/event-aggregator/default-event-aggregator\";\nimport { DefaultNavigationService } from \"./../services/navigation-service/default-navigation-service\";\nimport { DefaultStorageService } from \"./../services/storage-service/default-storage-service\";\nimport { ConfigurationManager } from \"n-config\";\n\n\n// public\nexport class ClientApp\n{\n    private readonly _appElementId: string;\n    private readonly _container: Container;\n    private readonly _componentManager: ComponentManager;\n    private readonly _pageManager: PageManager;\n    private _initialRoute: string;\n    private _app: any;\n    private _accentColor: string;\n    private _isBootstrapped: boolean = false;\n    \n    \n    public get container(): Container { return this._container; }\n\n\n    public constructor(appElementId: string)\n    {\n        given(appElementId, \"appElementId\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace()).ensure(t => t.startsWith(\"#\"));\n        this._appElementId = appElementId;\n        this._container = new Container();\n        this._componentManager = new ComponentManager(Vue, this._container);\n        this._pageManager = new PageManager(VueRouter, this._container);\n\n        Vue.config.silent = false;\n        Vue.config.devtools = false;\n        Vue.config.performance = false;\n        Vue.config.productionTip = false;\n    }\n\n\n    public useInstaller(installer: ComponentInstaller): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useInstaller\");\n\n        given(installer, \"installer\").ensureHasValue();\n        this._container.install(installer);\n        return this;\n    }\n\n    public useAccentColor(color: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAccentColor\");\n\n        given(color, \"color\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace())\n            .ensure(t => t.trim().startsWith(\"#\"), \"must be hex value\");\n\n        this._accentColor = color.trim();\n        return this;\n    }\n\n    public registerComponents(...componentViewModelClasses: Function[]): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"registerComponents\");\n\n        this._componentManager.registerComponents(...componentViewModelClasses);\n        return this;\n    }\n\n    public registerPages(...pageViewModelClasses: Function[]): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"registerPages\");\n\n        this._pageManager.registerPages(...pageViewModelClasses);\n        return this;\n    }\n\n    public useAsInitialRoute(route: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsInitialRoute\");\n\n        if (this._pageManager.useHistoryMode)\n            throw new InvalidOperationException(\"Cannot use initial route with history mode.\");\n        \n        given(route, \"route\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        this._initialRoute = route.trim();\n        return this;\n    }\n\n    public useAsUnknownRoute(route: string): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useAsUnknownRoute\");\n\n        given(route, \"route\").ensureHasValue().ensure(t => !t.isEmptyOrWhiteSpace());\n        this._pageManager.useAsUnknownRoute(route);\n        return this;\n    }\n    \n    public useHistoryModeRouting(): this\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"useHistoryModeRouting\");\n        \n        if (this._initialRoute)\n            throw new InvalidOperationException(\"Cannot use history mode with initial route.\");\n        \n        this._pageManager.useHistoryModeRouting();\n        return this;\n    }\n\n    // public enableDevMode(): this\n    // {\n    //     if (this._isbootstrapped)\n    //         throw new InvalidOperationException(\"enableDevMode\");\n\n    //     Config.enableDev(Vue);\n    //     return this;\n    // }\n\n    public bootstrap(): void\n    {\n        if (this._isBootstrapped)\n            throw new InvalidOperationException(\"bootstrap\");\n\n        this.configureGlobalConfig();\n        this.configureComponents();\n        this.configurePages();\n        this.configureInitialRoute();\n        this.configureCoreServices();\n        this.configureContainer();\n        this.configureRoot();\n\n        this._isBootstrapped = true;\n    }\n    \n    private configureGlobalConfig(): void\n    {\n        if (ConfigurationManager.getConfig(\"env\") === \"dev\")\n        {\n            console.log(\"Bootstrapping in DEV mode.\");\n\n            Vue.config.silent = false;\n            Vue.config.devtools = true;\n            Vue.config.performance = true;\n            Vue.config.productionTip = true;\n        }\n        else\n        {\n            Vue.config.silent = true;\n            Vue.config.devtools = false;\n            Vue.config.performance = false;\n            Vue.config.productionTip = false;\n        }\n    }\n\n\n    private configureComponents(): void\n    {\n        this._componentManager.bootstrap();\n    }\n\n    private configurePages(): void\n    {\n        this._pageManager.bootstrap();\n    }\n\n    private configureInitialRoute(): void\n    {\n        if (!this._pageManager.vueRouterInstance || this._pageManager.useHistoryMode)\n            return;\n\n        if (!window.location.hash)\n        {\n            if (this._initialRoute)\n                window.location.hash = \"#\" + this._initialRoute;\n        }\n        else\n        {\n            let hashVal = window.location.hash.trim();\n            if (hashVal.length === 1)\n            {\n                if (this._initialRoute)\n                    window.location.hash = \"#\" + this._initialRoute;\n            }\n            else\n            {\n                hashVal = hashVal.substr(1);\n                if (hashVal === \"/\")\n                {\n                    if (this._initialRoute)\n                        window.location.hash = \"#\" + this._initialRoute;\n                }\n            }\n        }\n    }\n\n    private configureCoreServices(): void\n    {\n        this._container\n            .registerInstance(\"DialogService\", new DefaultDialogService(this._accentColor))\n            .registerInstance(\"EventAggregator\", new DefaultEventAggregator())\n            .registerInstance(\"NavigationService\", new DefaultNavigationService(this._pageManager.vueRouterInstance))\n            .registerInstance(\"StorageService\", new DefaultStorageService())\n            ;\n    }\n\n    private configureContainer(): void\n    {\n        this._container.bootstrap();\n    }\n\n    private configureRoot(): void\n    {\n        this._app = new Vue({\n            el: this._appElementId,\n            router: this._pageManager.vueRouterInstance\n        });\n    }\n}"]}